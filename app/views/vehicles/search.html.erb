<!--completed-->

<% provide(:title, "Vehicle Search") %>

<header class="header-fixed-visible">
  <%= render 'layouts/header_secondary' %>
</header>

<%= render 'layouts/modal_search' %>

<%= render 'layouts/modal_menu' %>

<%= render 'modal_special_offer' %>

<div class="search-summary">
  <div class="search-summary-content">
    
    <h1 class="search-summary-title">
      
      <% if params[:vehicle][:vehicle_make_id].present? %>
      
        <%= VehicleMake.find_by(id: params[:vehicle][:vehicle_make_id]).name %>
        <%= VehicleModel.find_by(id: params[:vehicle][:vehicle_model_id]).name  if VehicleModel.find_by(id: params[:vehicle][:vehicle_model_id]).name != "All models" %>
        
      <% else %>
        All Makes and Models</h1>
      <% end %>
    </h1>
    
    <h2 class="search-summary-info">
      
      <% if params[:city].present? %>
      
        <%= pluralize(@vehicles.count, "vehicle") %> found near 
        <%= params[:city] %>

      <% else %>
        Enter a city to narrow your search
      <% end %>
    </h2>
  </div>
</div>

<div class="search-results">
  
  <div id="search-map" class="hidden-xs"></div>
  
  <div class="search-results-background">
    <div class="search-list-container">
      <div class="row">
        
        <div class="col-md-4 hidden-xs">
          <!--intentionally left empty-->
        </div>
        
        <div class="col-md-8 search-list-content">
          
          <div class="search-filters">
            <%= render 'search_filters' %>
          </div>
          
          <div class="search-items-container">
            
            <div class="search-introduction">
            
              <div class="search-introduction-static">
                
                <i class="fa fa-times search-introduction-static-close"></i>
                
                <div class="row vertical-align">
                  
                  <div class="col-md-2">
                    <%= image_tag("https://s3.us-east-2.amazonaws.com/motominion-assets/static-assets/search-introduction.png") %>
                  </div>
                  
                  <div class="col-md-10">
                    
                    <span class="search-introduction-static-title">
                      Motorcycles in Your Area
                    </span>
                
                    <p class="search-introduction-static-info">
                      Find and compare motorcycles in your area with 
                      Motominion.com. We list over 30,000 vehicles from hundreds 
                      of dealerships across the country. We will walk you 
                      through every step of the purchasing experience!
                    </p>
                  </div>
                </div>
              </div>
              
              <div class="search-introduction-dynamic">
                <div class="row">
                  
                  <div class="col-md-3">
                    <span class="search-introduction-dynamic-title">
                      
                      Newest Listings 
                      
                      <!--<(perc) if params[:city].present? %>-->
                      <!--  - <(perc)= params[:city] %>-->
                      <!--<(perc) end %>-->
                    </span>
                  </div>
                  
                  <div class="col-md-9 marquee">
                    <div>
  
                      <span>
                        
                        <strong><%= Vehicle.first.listing_name %>:</strong> 
                        $<%= Vehicle.first.price %>  
                        
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        
                        <strong><%= Vehicle.second.listing_name %>:</strong> 
                        $<%= Vehicle.second.price %>
                        
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        
                        <strong><%= Vehicle.third.listing_name %>:</strong> 
                        $<%= Vehicle.third.price %>
                      </span>
  
                      <span>
                        
                        <strong><%= Vehicle.first.listing_name %>:</strong>
                        $<%= Vehicle.first.price %>
                        
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        
                        <strong><%= Vehicle.second.listing_name %>:</strong>
                        $<%= Vehicle.second.price %>
                        
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        
                        <strong><%= Vehicle.third.listing_name %>:</strong>
                        $<%= Vehicle.third.price %>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="filter-controls">
              
              <button class="btn-filters">
                <i class="fa fa-sliders fa-lg filters-icon" 
                   aria-hidden="true"></i>Filters
              </button>
              
              <div class="form-group form-group-primary search-sort">
                
                <label for="sort">Sort By:</label>
                
                <div class="form-element-primary">
                  
                  <select class="form-control search-sort-form-control" id="sort">
                    <option><%= link_to "Nearest", '#' %></option>
                    <option><%= link_to "Most Popular", '#' %></option>
                    <option><%= link_to "Lowest Price", :sort => "price" %></option>
                  </select>
                  
                  <i class="fa fa-caret-down fa-lg form-caret" 
                     aria-hidden="true"></i>
                </div>
              </div>
            </div>
            
            <% if @vehicles.any? %>
              <ol class="row search-items">
                <%= render partial:    "search_item", 
                           collection: @vehicles, 
                           as:         :vehicle %>
              </ol>
            <% end %>
            
            <div class="search-advice">
              <div class="search-advice-content">
                
                <div class="row vertical-align hidden-xs">
                  
                  <div class="col-md-2">
                    <i class="fa fa-comments-o fa-4x advice-icon" 
                       aria-hidden="true"></i>
                  </div>
                
                  <div class="col-md-7">
                    
                    <h2 class="advice-title">
                      Need free advice? Talk to our team!
                    </h2>
                    
                    <p class="advice-info">
                      Our experts can help you find the perfect vehicle.
                    </p>
                  </div>
                
                  <div class="col-md-3">
                    <%= link_to "Get In Touch", 
                                new_enquiry_path, 
                                class: "btn btn-green" %>
                  </div>
                </div>
                
                <div class="visible-xs">
                  <div class="row vertical-align">
                    
                    <div class="col-xs-3">
                      <i class="fa fa-comments-o fa-4x advice-icon" 
                         aria-hidden="true"></i>
                    </div>
                  
                    <div class="col-xs-9">
                      
                      <h2 class="advice-title">
                        Need free advice? Talk to our team!
                      </h2>
                      
                      <p class="advice-info">
                        Our experts can help you find the perfect vehicle.
                      </p>
                    </div>
                  </div>
                
                  <%= link_to "Get In Touch", 
                              new_enquiry_path, 
                              class: "btn btn-green btn-get-in-touch" %>
                </div>
              </div>
            </div>

            <%= will_paginate @vehicles, 
                previous_label: 
                  '<i class="fa fa-arrow-left" aria-hidden="true"></i>', 
                next_label: 
                  '<i class="fa fa-arrow-right" aria-hidden="true"></i>',
                inner_window: 1, 
                outer_window: 0 %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function() {
  
    // map
    
      var hoverMarkerIcon = {
        url:    "https://s3.us-east-2.amazonaws.com/online-dealership-assets/static-assets/map-marker-aqua.png",
        width:  32,
        height: 32
      };
      
      handler = Gmaps.build('Google');
      
      handler.buildMap({
        
        provider: {
          
          maxZoom:           14,
          scrollwheel:       false,
          mapTypeControl:    false,
          streetViewControl: false,
          
          zoomControlOptions: {
            position: google.maps.ControlPosition.TOP_LEFT
          },
          styles: [
    {
        "featureType": "landscape",
        "stylers": [
            {
                "hue": "#FFBB00"
            },
            {
                "saturation": 43.400000000000006
            },
            {
                "lightness": 37.599999999999994
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "road.highway",
        "stylers": [
            {
                "hue": "#FFC200"
            },
            {
                "saturation": -61.8
            },
            {
                "lightness": 45.599999999999994
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "stylers": [
            {
                "hue": "#FF0300"
            },
            {
                "saturation": -100
            },
            {
                "lightness": 51.19999999999999
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "road.local",
        "stylers": [
            {
                "hue": "#FF0300"
            },
            {
                "saturation": -100
            },
            {
                "lightness": 52
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "water",
        "stylers": [
            {
                "hue": "#0078FF"
            },
            {
                "saturation": -13.200000000000003
            },
            {
                "lightness": 2.4000000000000057
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "poi",
        "stylers": [
            {
                "hue": "#00FF6A"
            },
            {
                "saturation": -1.0989010989011234
            },
            {
                "lightness": 11.200000000000017
            },
            {
                "gamma": 1
            }
        ]
    }
]
        },
        
        internal: {
          id: 'search-map'
        }
      }, function() {
        
        markers = handler.addMarkers(<%=raw @hash.to_json %>);
        
        _.each(<%=raw @hash.to_json %>, function(json, index) {
          var hoverMarker = {};
          
          hoverMarker.marker = void 0;
          json.marker = markers[index];
          
          $("#search-item-" + json.id).on("mouseover", function() {
            
            hoverMarker = {
              lat: json.lat,
              lng: json.lng,
              picture: hoverMarkerIcon
            };
            
            handler.removeMarker(json.marker);
            hoverMarker.marker = handler.addMarker(hoverMarker);
          }).on("mouseout", function() {
            handler.removeMarker(hoverMarker.marker);
            json.marker = handler.addMarker(json);
          });
        });
        
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
      });
    
    // filters
    
      var filtersButton        = $('.btn-filters');
      var cancelButton         = $('.btn-cancel-filters');
      var searchFilters        = $('.search-filters');
      var searchItemsContainer = $('.search-items-container')
  
      filtersButton.click(function() {
        searchFilters.slideToggle();
        searchItemsContainer.slideToggle();
      });
      
      cancelButton.click(function() {
        searchFilters.slideToggle();
        searchItemsContainer.slideToggle();
      });
    
    // sliders
    
      var priceSlider           = $('#price_slider');
      var mileageSlider         = $('#mileage_slider');
      var yearSlider            = $('#year_slider');
      var engineSizeSlider      = $('#engine_size_slider');
      var priceSliderValue      = $('#price_slider_val');
      var mileageSliderValue    = $('#mileage_slider_val');
      var yearSliderValue       = $('#year_slider_val');
      var engineSizeSliderValue = $('#engine_size_slider_val')
      
      priceSlider.slider();
      mileageSlider.slider();
      yearSlider.slider();
      engineSizeSlider.slider();
      
      priceSlider.on('slide', function(slideEvt) {
      	priceSliderValue.text('$' + slideEvt.value);
      });
      mileageSlider.on('slide', function(slideEvt) {
      	mileageSliderValue.text(slideEvt.value + ' km');
      });
      yearSlider.on('slide', function(slideEvt) {
      	yearSliderValue.text(slideEvt.value);
      });
      engineSizeSlider.on('slide', function(slideEvt) {
      	engineSizeSliderValue.text(slideEvt.value + ' cc');
      });
      
      priceSlider.on('slideStop', function(slideEvt) {
      	priceSliderValue.text('$' + slideEvt.value);
      });
      mileageSlider.on('slideStop', function(slideEvt) {
      	mileageSliderValue.text(slideEvt.value + ' km');
      });
      yearSlider.on('slideStop', function(slideEvt) {
      	yearSliderValue.text(slideEvt.value);
      });
      engineSizeSlider.on('slideStop', function(slideEvt) {
      	engineSizeSliderValue.text(slideEvt.value + ' cc');
      });
  });
</script>

<!--title modification-->
<!--https://www.elastic.co/guide/en/elasticsearch/reference/current/_installation.html-->